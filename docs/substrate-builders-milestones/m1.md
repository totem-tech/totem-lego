# Totem Technical Milestone - M1

**This specification is for the deliverables in the Substrate Builders Program.**

_It should be noted that as Totem has been building for more than two years on Substrate, the milestones should be viewed in the context of the considerable work that has already been developed, and these deliverables are part of an on-going 3 year roadmap._

The background to the project and functional documentation can be found [https://docs.totemaccounting.com](https://docs.totemaccounting.com).

The Substrate code is available at [https://rustdocs.totemaccounting.com](https://rustdocs.totemaccounting.com).

## Overview of tasks M1

---

For this Milestone the technical tasks are to develop and set the correct weighting mechanism for each of Totemâ€™s public APIs in each of the Totem Pallets. 

Deliverables are indicated as: 

 `M<numberOfMilestone>.<numberOfDeliverable>`

### In-scope deliverables for M1

The following pallets have external facing apis and are in-scope for the deliverables. The links will take you to the requirements set out in this document:

#### Mandatory deliverables

01. [pallet-teams](###pallet-teams)

02. [pallet-timekeeping](###pallet-timekeeping)

03. [pallet-transfer](###pallet-transfer)

#### Non-mandatory deliverables

04. [pallet-orders](###pallet-orders)

05. [pallet-funding](###pallet-funding)

06. [pallet-archive](###pallet-archive)

#### Non-mandatory application layer tasks

In addition there are a number of application layer tasks that are part of the overall Totem Live Accounting Application Roadmap and should not be considered mandatory as part of the Substrate Builders program, (as there may be unforeseen implementation issues surrounding building an entirely new form of accounting protocols) but are provided here to give an overall picture of workload for the team. 

These application layer tasks are components that will be required to meet the full product beta launch, and contain elements of front-end engineering, as well as blockchain engineering. These tasks are not full specified in this document. 

Specifications for these tasks are created during the course of implementation and stored in the issues list in our public Gitlab repo.

The sequence of delivery considers the known dependencies within these tasks.

#### Headline Deliverables

07. OTC Decentralised Exchange 
    
    * Based on the Orders module allows users to exchange off-chain items (not just cryptocurrency). 

08. Bounty Program & Marketplace

    * A Gitcoin-like Marketplace within Totem.

09. Integration of Chainlink Price Feeds

    * Required to create the deterministic exchange rate for Totem currency.

10. Exchange Rates feed automation

    * For non-chainlink assets, in order to create the official daily rates for accounting purposes. 

11. Crypto and Fiat Market cap and circulating units datafeed
    
    * Required to create the deterministic exchange rate for Totem currency.

12. Purchase Management

    * Managing orders.

13. Quantity Accounting

    * Required to account for product stock and asset tracking

14. Ledger manual adjustment including opening balance  

    * Although the system is p2p and this functionality should not be needed, users who migrate from other systems will require this to start using Totem. 

15. Expenses

    * Feature when using Totem in standalone mode.

16. Disputed Items

    * Support for disputed items.

17. Units of measure and conversions

    * Required for conversions between units of products. 

## Out-of-Scope for M1

---

There are several Totem pallets that do not have external APIs and are not in-scope for weighting calculations in this milestone - as they are called by other functions. These are:

* pallet-accounting

* pallet-bonsai

* pallet-prefunding

Totem uses a fork of the Substrate standard Balances module which contains a specific set of locks for our escrow mechanism. This is also out-of-scope as the public APIs have already been weighted, and the Totem enhancement is not public facing.

* pallet-balances-totem

# Deliverable Specifications 

```rust
#[pallet::weight(n)] 
````

Each function listed below should apply the weights feature with the appropriate weight for the estimated cost of execution for an extrinsic. This can be set dynamically and calculated using the various scripts available.

* A function cannot have a zero weight.


* Any excessive weight value should be raised as an issue for further investigation and optimisation.

* Code optimisation effort is not part of the deliverables. 

## Deliverable M1.1

### pallet-teams

---

Each of the following functions are implicated in this technical deliverable M1.1 in this pallet. 

_**Note:** this pallet used to be called "projects" but was renamed as the functionality was more "team-like". This will be adjusted as part of a larger overhaul or projects/teams functionality but this work is not in-scope for this deliverable._

```rust 
//#[pallet::weight(n)] 
fn add_new_project(

    origin: OriginFor<T>,
    project_hash: T::Hash,

) -> DispatchResultWithPostInfo

```

```rust
//#[pallet::weight(n)] 
fn remove_project(
    origin: OriginFor<T>,
    project_hash: T::Hash,
) -> DispatchResultWithPostInfo
```

```rust
//#[pallet::weight(n)] 
fn reassign_project(
    origin: OriginFor<T>,
    new_owner: T::AccountId,
    project_hash: T::Hash,
) -> DispatchResultWithPostInfo
```

```rust
//#[pallet::weight(n)] 
fn close_project(
    origin: OriginFor<T>,
    project_hash: T::Hash,
) -> DispatchResultWithPostInfo
```

```rust
//#[pallet::weight(n)] 
fn reopen_project(
    origin: OriginFor<T>,
    project_hash: T::Hash,
) -> DispatchResultWithPostInfo
```

```rust
//#[pallet::weight(n)] 
fn set_status_project(
    origin: OriginFor<T>,
    project_hash: T::Hash,
    project_status: ProjectStatus,
) -> DispatchResultWithPostInfo
```

## Deliverable M1.2

### pallet-timekeeping

---

Each of the following functions are implicated in this technical deliverable M1.2 in this pallet. 

_**Note 1 :** this pallet is closely tied to the former "projects" pallet, now called `pallet-teams`. This will be adjusted as part of a larger overhaul or projects/teams functionality but this work is not in-scope for this deliverable._




```rust 
//#[pallet::weight(n)]
fn notify_project_worker(
    origin: OriginFor<T>,
    worker: T::AccountId,
    project_hash: T::Hash,
) -> DispatchResultWithPostInfo

```
```rust 
//#[pallet::weight(n)]
fn worker_acceptance_project(
    origin: OriginFor<T>,
    project_hash: T::Hash,
    accepted: AcceptAssignedStatus,
) -> DispatchResultWithPostInfo
```
```rust 
//#[pallet::weight(n)]
fn submit_time(
    origin: OriginFor<T>,
    project_hash: T::Hash,
    input_time_hash: T::Hash,
    submit_status: StatusOfTimeRecord,
    _reason_for_change: ReasonCodeStruct,
    number_of_blocks: NumberOfBlocks,
    _posting_period: PostingPeriod,
    start_block_number: StartOrEndBlockNumber,
    end_block_number: StartOrEndBlockNumber,
    break_counter: NumberOfBreaks,
) -> DispatchResultWithPostInfo
```
```rust 
//#[pallet::weight(n)]
fn authorise_time(
    origin: OriginFor<T>,
    _worker: T::AccountId,
    project_hash: T::Hash,
    input_time_hash: T::Hash,
    status_of_record: StatusOfTimeRecord,
    _reason: ReasonCodeStruct,
) -> DispatchResultWithPostInfo
```

_**Note 2 :** There are also a number of WIP functions that are not yet completed and so cannot be fully measured for weighting. These are out-of-scope for this deliverable, until they have been developed. For completeness these are as follows:_

```rust
fn pay_time(
    origin: OriginFor<T>,
    _project_hash: T::Hash,
    _input_time_hash: T::Hash,
) -> DispatchResultWithPostInfo 

fn lock_time_record(
    _origin: OriginFor<T>,
    _project_hash: T::Hash,
    _input_time_hash: T::Hash,
) -> DispatchResultWithPostInfo

fn unlock_time_record(
    _origin: OriginFor<T>,
    _project_hash: T::Hash,
    _input_time_hash: T::Hash,
) -> DispatchResultWithPostInfo 

fn ban_worker(
    _origin: OriginFor<T>,
    _project_hash: T::Hash,
    _worker: T::AccountId,
) -> DispatchResultWithPostInfo 

fn unban_worker(
    _origin: OriginFor<T>,
    _project_hash: T::Hash,
    _worker: T::AccountId,
) -> DispatchResultWithPostInfo
```


## Deliverable M1.3

### pallet-transfer

---

This pallet is still a WIP but should be measured as is. The remaining tasks on this pallet is to record the accounting correctly for each transfer. This pallet exists as a wrapper to the standard Substrate implementation of balance transfer function so that we can add accounting and off-line transaction tracking functionality.

```rust
//#[pallet::weight(n)]
fn transfer(
    origin: OriginFor<T>,
    to: T::AccountId,
    #[pallet::compact] payment_amount: T::Balance,
    tx_uid: T::Hash,
) -> DispatchResultWithPostInfo
```

## Deliverable M1.4

### pallet-orders

---

Each of the following functions are implicated in this technical deliverable M1.4 in this pallet. 


```rust
//#[pallet::weight(n)]
fn delete_order(
    origin: OriginFor<T>, 
    tx_keys_medium: TXKeysM<T::Hash>
) -> DispatchResultWithPostInfo
```

```rust 
//#[pallet::weight(n)]
fn create_order(
    origin: OriginFor<T>,
    approver: T::AccountId,
    fulfiller: T::AccountId,
    buy_or_sell: u16,
    total_amount: i128,
    market_order: bool,
    order_type: u16,
    deadline: u32,
    due_date: u32,
    order_items: Vec<OrderItem<T::Hash>>,
    tx_keys_large: TXKeysL<T::Hash>,
) -> DispatchResultWithPostInfo
```
```rust 
//#[pallet::weight(n)]
fn create_spfso(
    origin: OriginFor<T>,
    approver: T::AccountId,
    fulfiller: T::AccountId,
    buy_or_sell: u16,               
    total_amount: i128,             
    market_order: bool,             
    order_type: u16,                
    deadline: u32,                  
    due_date: u32,                  
    order_item: OrderItem<T::Hash>,
    bonsai_token: T::Hash,
    tx_uid: T::Hash,
) -> DispatchResultWithPostInfo
```
```rust 
//#[pallet::weight(n)]
fn change_spfso(
    origin: OriginFor<T>,
    approver: T::AccountId,
    fulfiller: T::AccountId,
    amount: i128,
    deadline: u32,
    due_date: u32,
    order_item: OrderItem<T::Hash>,
    record_id: T::Hash,
    bonsai_token: T::Hash,
    tx_uid: T::Hash,
) -> DispatchResultWithPostInfo
```

```rust 
//#[pallet::weight(n)]
fn change_approval(
    origin: OriginFor<T>,
    h: T::Hash,
    s: ApprovalStatus,
    b: T::Hash,
    tx_uid: T::Hash,
) -> DispatchResultWithPostInfo
```
```rust 
//#[pallet::weight(n)]
fn handle_spfso(
    origin: OriginFor<T>,
    h: T::Hash,
    s: OrderStatus,
    tx_uid: T::Hash,
) -> DispatchResultWithPostInfo
```

## Deliverable M1.5

### pallet-funding

---

Each of the following functions are implicated in this technical deliverable M1.5 in this pallet.

```rust
//#[pallet::weight(n)]
fn set_controller_account(
    origin: OriginFor<T>, 
    controller: T::AccountId
) -> DispatchResultWithPostInfo 
```
```rust 
//#[pallet::weight(n)]
fn set_transfer_status(
    origin: OriginFor<T>
) -> DispatchResultWithPostInfo
```
```rust 
//#[pallet::weight(n)]
fn mint_coins(
    origin: OriginFor<T>, 
    quantity: u128
) -> DispatchResultWithPostInfo
```
```rust 
//#[pallet::weight(n)]
fn rebalance_issued_coins(
    origin: OriginFor<T>, 
    amount: u128
    ) -> DispatchResultWithPostInfo
```
```rust 
//#[pallet::weight(n)]
fn distribute(
    origin: Origi#nFor<T>, 
    to: T::AccountId, 
    amount: u128) -> DispatchResultWithPostInfo
```
```rust 
//#[pallet::weight(n)]
fn transfer(
    origin: OriginFor<T>, 
    to: T::AccountId, 
    amount: u128) -> DispatchResultWithPostInfo
```

## Deliverable M1.6

### pallet-archive

---

Only one function is implicated in this technical deliverable M1.6 in this pallet. 

```rust 
//#[pallet::weight(n)]
fn archive_record(
    origin: OriginFor<T>,
    record_type: RecordType,
    bonsai_token: T::Hash,
    archive: bool,
) -> DispatchResultWithPostInfo 
```